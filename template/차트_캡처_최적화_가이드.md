# 차트 캡처 최적화 표준 가이드

## 개요
HTML 기반 차트를 Chrome headless로 캡처할 때 완벽한 결과를 얻기 위한 표준 설정입니다.

## 1. CSS 최적화 설정

### 기본 Body 스타일
```css
body {
    font-family: 'Malgun Gothic', sans-serif;
    margin: 0;
    padding: 0;                    /* 20px → 0px로 변경 */
    background: white;             /* #f0f0f0 → white로 변경 */
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: auto;
}
```

### Container 스타일
```css
.container {
    background: white;
    border-radius: 15px;
    padding: 15px;               /* 30px → 15px로 변경 */
    box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    width: 100%;
}
```

## 2. 차트별 최적 캡처 사이즈

### 사이즈 계산 공식
`캡처 사이즈 = 컨테이너 max-width + (padding × 2) + 컨텐츠 여백`

### 표준 사이즈 매핑
| 차트 유형 | max-width | 캡처 사이즈 | 설명 |
|-----------|-----------|-------------|------|
| system_architecture | 1000px | 1100×750 | 계층 구조 + 화살표 여백 |
| market_growth | 1200px | 1200×650 | 차트 2개 나란히 배치 |
| budget_distribution | 1200px | 1200×650 | 차트 2개 나란히 배치 |
| swot_analysis | 1000px | 1000×750 | SWOT 매트릭스 + 전략 섹션 |
| trl_roadmap | 1200px | 1200×900 | TRL 단계별 로드맵 |
| organization_chart | 1000px | 1000×700 | 조직 계층 구조 |
| risk_matrix | 800px | 800×750 | 매트릭스 + 범례 |

## 3. Chrome 캡처 옵션

### 필수 옵션
```python
chrome_options = [
    "--headless",
    "--disable-gpu",
    "--disable-web-security", 
    "--hide-scrollbars",                    # 스크롤바 제거
    "--force-device-scale-factor=1",        # 선명한 캡처
    "--window-size=WIDTH,HEIGHT",           # 차트별 최적 사이즈
    "--virtual-time-budget=5000",
    "--run-all-compositor-stages-before-draw"
]
```

## 4. 자동 사이즈 선택 로직

```python
def get_optimal_window_size(html_file_path):
    """파일명 기반 최적 사이즈 자동 선택"""
    size_mapping = {
        "system_architecture": "1100,750",
        "market_growth": "1200,650", 
        "budget_distribution": "1200,650",
        "swot_analysis": "1000,750",
        "trl_roadmap": "1200,900",
        "organization_chart": "1000,700", 
        "risk_matrix": "800,750"
    }
    
    for chart_type, size in size_mapping.items():
        if chart_type in html_file_path:
            return size
    return "1000,600"  # 기본값
```

## 5. 품질 검증 체크리스트

### 캡처 품질 확인사항
- [ ] 세로로 짤리지 않음 (전체 컨텐츠 표시)
- [ ] 가로로 짤리지 않음 (모든 요소 표시)
- [ ] 불필요한 여백 최소화
- [ ] 스크롤바 없음
- [ ] 텍스트 선명하게 표시
- [ ] 차트/그래프 완전 표시

### 문제 해결 가이드
1. **세로 짤림**: 캡처 높이 증가 (예: 700→750)
2. **가로 짤림**: 캡처 너비 증가 (예: 1000→1100)
3. **과도한 여백**: body/container padding 감소
4. **스크롤바 표시**: `--hide-scrollbars` 옵션 확인
5. **흐릿한 캡처**: `--force-device-scale-factor=1` 옵션 확인

## 6. 향후 새 차트 추가 시 가이드

### 1단계: HTML 컨테이너 크기 확인
```css
.container {
    max-width: ???px;  /* 이 값 확인 */
    padding: 15px;     /* 고정값 */
}
```

### 2단계: 컨텐츠 높이 추정
- 제목: ~60px
- 주요 컨텐츠: 차트/표/구조에 따라 가변
- 하단 여백: ~50px

### 3단계: 최적 캡처 사이즈 계산
```
너비 = max-width + 100px (여유분)
높이 = 컨텐츠 예상 높이 + 100px (여유분)
```

### 4단계: 테스트 및 미세 조정
1. 초기 사이즈로 캡처
2. 짤림 여부 확인
3. 필요시 +50px씩 조정
4. 최적 사이즈 확정 후 매핑에 추가

## 7. 코드 템플릿 적용 방법

기존 차트 생성기를 `OptimizedHTMLChartGenerator` 템플릿으로 교체:

```python
from template.최적화된_차트_생성_템플릿 import OptimizedHTMLChartGenerator

generator = OptimizedHTMLChartGenerator()
result = generator.generate_chart("new_chart", create_new_chart_function)
```

이 가이드를 따르면 처음부터 완벽한 차트 캡처가 가능합니다.